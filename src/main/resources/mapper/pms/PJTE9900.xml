<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.iteyes.mapper.pms.PJTE9900Mapper">
	<select id="select_0000_01" parameterType="Map" resultType="Map">
	   SELECT GRP_TYCD
			, DTLS_TYCD
			, DTLS_TYNM
			, SORT_SEQ
		 FROM pms_cd_del_mng
		     _mng
		WHERE USE_YN   = 'Y'
		  AND GRP_TYCD = '0000000000'
		  AND PRJT_ID  = '0000000000'
		  AND BKUP_ID  = '0000000000'
		UNION
	   SELECT GRP_TYCD
			, DTLS_TYCD
			, DTLS_TYNM
			, SORT_SEQ
		 FROM pms_cd_del_mng
		WHERE USE_YN    = 'Y'
		  AND GRP_TYCD  != '1000000027'
          AND PRJT_ID   = #{prjt_id}
		  AND BKUP_ID   = '0000000000'
		UNION
	   SELECT GRP_TYCD
			, DTLS_TYCD
			, DTLS_TYNM
			, CASE WHEN DTLS_TYCD = '0000000000' THEN -99999999999 ELSE 0 - SORT_SEQ END AS SORT_SEQ
	 	 FROM pms_cd_del_mng
		WHERE USE_YN   = 'Y'
		  AND GRP_TYCD = '1000000027'
		  AND PRJT_ID  = #{prjt_id}
		  AND BKUP_ID  = '0000000000'
		ORDER BY 1, 4
		</select>
  <select id="select_9900_01" parameterType="Map" resultType="com.iteyes.dto.pms.PJTE9900DTO">
	  SELECT *
	    FROM pms_kanban_mng
       WHERE 1=1
    </select>

	<insert id="insert_9900_01" parameterType="Map">
   <![CDATA[
		INSERT INTO pms_pgm_mng
		(
			  BKUP_ID      /*백업ID*/
			, PRJT_ID      /*프로젝트ID*/
			, BZCD         /*업무구분코드*/
			, PGM_ID       /*프로그램ID*/
			, BZ_DTLS_TXT  /*업무세부내용*/
			, PGM_NM       /*프로그램명*/
			, DVLP_DIS_CD  /*개발구분코드*/
			, PGM_DIS_CD   /*프로그램구분코드*/
			, ENLPE_NM     /*프로그램세부구분코드*/
			, FRCS_STA_DT  /*계획시작일자*/
			, FRCS_END_DT  /*계획종료일자*/
			, STA_DT       /*실제시작일자*/
			, END_DT       /*실제종료일자*/
			, PRC_STEP_CD  /*처리단계코드*/
			, PRG_TXT      /*진행현황*/
			, DVLPE_NO     /*개발자번호*/
			, DVLPE_CNF_DT /*개발자확인일자*/
			, PL_NO        /*PL번호*/
			, PL_CNF_DT    /*PL확인일자*/
			, CRPE_NO      /*담당자번호*/
			, RMRK         /*비고*/
			, ATFL_MNG_ID  /*첨부파일관리ID*/
		    , PAL_ATFL_MNG_ID  /*설계서첨부파일관리ID*/
			, OPR_NO       /*조작자번호 */
			, DB_CHG_TS    /*DB변경일시*/
		)
		VALUES
			(
				'0000000000'
				, #{prjt_id}                          /*프로젝트ID*/
				, #{bzcd}                             /*업무구분코드*/
				, #{pgm_id}                           /*프로그램ID*/
				, #{bz_dtls_txt}                      /*업무세부내용*/
				, #{pgm_nm}                           /*프로그램명*/
				, #{dvlp_dis_cd}                      /*개발구분코드*/
				, #{pgm_dis_cd}                       /*프로그램구분코드*/
				, #{enlpe_nm}                         /*프로그램세부구분코드*/
				, REPLACE(#{frcs_sta_dt}, '-', '')    /*계획시작일자*/
				, REPLACE(#{frcs_end_dt}, '-', '')    /*계획종료일자*/
				, ''                                /*실제시작일자*/
				, ''                                /*실제종료일자*/
				, '000'                               /*처리단계코드*/
				, #{prg_txt}                          /*진행현황*/
				, #{dvlpe_no}                         /*개발자번호*/
				, ''                                /*개발자확인일자*/
				, #{pl_no}                            /*PL번호*/
				, ''                                /*PL확인일자*/
				, #{crpe_no}                          /*담당자번호*/
				, #{rmrk}                             /*비고*/
				, #{atfl_mng_id}                      /*첨부파일관리ID*/
				, ''                                  /*설계서첨부파일관리ID*/
				, #{login_emp_no}                     /*조작자번호*/
				, DATE_FORMAT(NOW(),'%Y%m%d%H%i%s')   /*DB변경일시*/
			)
		]]>
  </insert>
  <update id="update_9900_01" parameterType="Map">
   <![CDATA[
	  UPDATE pms_pgm_mng
	  SET BZ_DTLS_TXT  = #{bz_dtls_txt}  /*업무세부내용*/
		, PGM_NM       = #{pgm_nm}       /*프로그램명*/
		, DVLP_DIS_CD  = CASE WHEN #{login_aut_cd} IN ('500','600') THEN #{dvlp_dis_cd} ELSE DVLP_DIS_CD END  /*개발구분코드*/
		, PGM_DIS_CD   = #{pgm_dis_cd}   /*프로그램구분코드*/
		, ENLPE_NM     = #{enlpe_nm}     /*프로그램세부구분코드*/
		, FRCS_STA_DT  = CASE WHEN #{login_aut_cd} IN ('500','600') THEN REPLACE(#{frcs_sta_dt}, '-', '') ELSE FRCS_STA_DT END /*계획시작일자*/
		, FRCS_END_DT  = CASE WHEN #{login_aut_cd} IN ('500','600') THEN REPLACE(#{frcs_end_dt}, '-', '') ELSE FRCS_END_DT END /*계획종료일자*/
		, STA_DT       = CASE WHEN #{prc_step_cd} IN ('100','200') AND STA_DT IS NULL THEN DATE_FORMAT(NOW(),'%Y%m%d') ELSE  REPLACE(#{sta_dt}, '-', '') END /*실제시작일자*/
		, END_DT       = CASE WHEN #{prc_step_cd} = '400' AND #{end_dt} IS NULL THEN DATE_FORMAT(NOW(),'%Y%m%d') ELSE REPLACE(#{end_dt}, '-', '') END  /*실제종료일자*/
		, PRC_STEP_CD  = #{prc_step_cd}  /*처리단계코드*/
		, PRG_TXT      = #{prg_txt}      /*진행현황*/
		, DVLPE_NO     = #{dvlpe_no}     /*개발자번호*/
		, DVLPE_CNF_DT = CASE WHEN #{prc_step_cd} = '200' AND DVLPE_CNF_DT IS NULL THEN DATE_FORMAT(NOW(),'%Y%m%d') ELSE REPLACE(#{dvlpe_cnf_dt}, '-', '')  END /*개발자확인일자*/
		, PL_NO        = #{pl_no}        /*PL번호*/
		, PL_CNF_DT    = CASE WHEN #{prc_step_cd} = '300' AND PL_CNF_DT IS NULL THEN DATE_FORMAT(NOW(),'%Y%m%d') ELSE REPLACE(#{pl_cnf_dt}, '-', '')  END    /*PL확인일자*/
		, CRPE_NO      = #{crpe_no}      /*담당자번호*/
		, RMRK         = #{rmrk}         /*비고*/
		, OPR_NO       = #{login_emp_no}        /*조작자번호*/
		, ATFL_MNG_ID  = #{atfl_mng_id}  /*첨부파일관리ID*/
		, PAL_ATFL_MNG_ID = #{pal_atfl_mng_id}  /*설계서 첨부파일관리ID*/
		, DB_CHG_TS    = DATE_FORMAT(NOW(),'%Y%m%d%H%i%s')   /*DB변경일시*/
	  WHERE PGM_ID      = #{pgm_id}
		AND BZCD        = #{bzcd}
		AND PRJT_ID     = #{prjt_id}
		AND BKUP_ID     = #{bkup_id}
	  ]]>
  </update>

	<update id="update_9900_02" parameterType="Map">
   <![CDATA[
		UPDATE pms_pgm_mng
		   SET ATFL_MNG_ID  = #{atfl_mng_id}  /*첨부파일관리ID*/
		     , OPR_NO       = #{empno}
		     , DVLP_DIS_CD  = '400'
		     , DB_CHG_TS    = DATE_FORMAT(NOW(),'%Y%m%d')
		WHERE PGM_ID        = #{pgm_id}
		   AND BZCD         = #{bzcd}
		   AND PRJT_ID      = #{prjt_id}
		   AND BKUP_ID      = #{bkup_id}
		]]>
  </update>

	<delete id="delete_9900_01" parameterType="Map">
   <![CDATA[
		DELETE FROM pms_pgm_mng
		 WHERE PGM_ID        = #{pgm_id}
		   AND BZCD          = #{bzcd}
		   AND PRJT_ID       = #{prjt_id}
		   AND BKUP_ID       = #{bkup_id}
		]]>
  </delete>
</mapper>
